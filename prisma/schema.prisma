generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
  MANAGER
}

model User {
  id       Int            @id @default(autoincrement())
  email    String         @unique
  name     String?
  password String?
  rol      Role           @default(USER)
  tasks    Task[]
  clients  UserClient[]   // Many-to-many relationship with Client
}

// ====================== ENUMS ======================

enum Tip {
  SRL
  PFA
  II
  ASOC
  SA
  SPARL
}

enum DaNuNuECazul {
  DA
  NU
  NU_E_CAZUL
}

enum Impozit {
  MICRO_1
  MICRO_3
  PROFIT
}

enum DaLunarTrim {
  DA_LUNAR
  DA_TRIM
  NU
}

enum Administratie {
  DGRF_BUCURESTI
  AFCM_DGRF_BUCURESTI
  AFCN
  SECTOR_1
  SECTOR_2
  SECTOR_3
  SECTOR_4
  SECTOR_5
  SECTOR_6
  AJFP_ILFOV
  UFO_BUFTEA
  UFO_BRAGADIRU
  DGRF_BRASOV
  AJFP_ALBA
  UFM_AIUD
  UFM_BLAJ
  UFM_SEBES
  UFO_CAMPENI
  UFO_CUGIR
  UFO_ZLATNA
  AJFP_BRASOV
  UFM_FAGARAS
  UFM_SACELE
  UFM_CODLEA
  UFO_RUPEA
  UFO_VICTORIA
  UFO_ZARNESTI
  UFO_RASNOV
  AJFP_COVASNA
  UFM_TARGU_SECUIESC
  UFO_BARAOLT
  AJFP_HARGHITA
  UFM_ODORHEIU_SECUIESC
  UFM_TOPLITA
  UFM_GHEORGHENI
  AJFP_MURES
  UFM_SIGHISOARA
  UFM_REGHIN
  UFM_TARNAVENI
  UFO_LUDUS
  UFO_SOVATA
  AJFP_SIBIU
  UFM_MEDIAS
  UFO_AGNITA
  UFO_SALISTE
  UFO_AVRIG
  DGRF_CLUJ_NAPOCA
  AJFP_BIHOR
  UFO_ALESD
  UFO_BEIUS
  UFO_MARGHITA
  UFO_SALONTA
  AJFP_BISTRITA_NASAUD
  UFO_BECLEAN
  UFO_NASAUD
  UFO_SANGEORZ_BAI
  AJFP_CLUJ
  UFM_TURDA
  UFM_DEJ
  UFM_GHERLA
  UFO_HUEDIN
  AJFP_MARAMURES
  UFM_SIGHETU_MARMATIEI
  UFO_TARGU_LAPUS
  UFO_VISEU_DE_SUS
  AJFP_SATU_MARE
  UFM_CAREI
  UFO_NEGRESTI_OAS
  UFO_TASNAD
  AJFP_SALAJ
  UFO_SIMLEU_SILVANIEI
  UFO_JIBOU
  UFO_CEHU_SILVANIEI
  DGRF_CRAIOVA
  AJFP_DOLJ
  UFO_CALAFAT
  UFO_FILIASI
  UFO_SEGARCEA
  UFO_BECHET
  UFO_BAILESTI
  AJFP_GORJ
  UFO_MOTRU
  UFO_NOVACI
  UFO_TARGU_CARBUNESTI
  UFO_ROVINARI
  AJFP_MEHEDINTI
  UFO_STREHAIA
  UFO_ORSOVA
  UFO_VANJU_MARE
  UFO_BAIA_DE_ARAMA
  AJFP_OLT
  UFM_CARACAL
  UFO_BALS
  UFO_CORABIA
  AJFP_VALCEA
  UFM_DRAGASANI
  UFO_BALCESTI
  UFO_GURA_LOTRULUI
  UFO_HOREZU
  UFO_BABENI
  DGRF_GALATI
  AJFP_BRAILA
  UFO_INSURATEI
  UFO_FAUREI
  UFO_IANCA
  AJFP_BUZAU
  UFM_RAMNICU_SARAT
  UFO_POGOANELE
  UFO_PATARLAGELE
  AJFP_CONSTANTA
  UFM_MANGALIA
  UFM_MEDGIDIA
  UFO_EFORIE
  UFO_HARSOVA
  UFO_BANEASA
  AJFP_GALATI
  UFM_TECUCI
  UFO_TARGU_BUJOR
  AJFP_TULCEA
  UFO_SULINA
  UFO_BABADAG
  UFO_MACIN
  UFC_BAIA
  AJFP_VRANCEA
  UFM_ADJUD
  UFO_PANCIU
  DGRF_IASI
  AJFP_BACAU
  UFM_ONESTI
  UFO_BUHUSI
  UFO_MOINESTI
  UFC_PODU_TURCULUI
  AJFP_BOTOSANI
  UFM_DOROHOI
  UFO_DARABANI
  UFO_SAVENI
  AJFP_IASI
  UFM_PASCANI
  UFO_HARLAU
  UFO_TARGU_FRUMOS
  UFC_RADUCANENI
  AJFP_NEAMT
  UFM_ROMAN
  UFO_TARGU_NEAMT
  UFO_BICAZ
  AJFP_SUCEAVA
  UFM_CAMPULUNG_MOLDOVENESC
  UFM_FALTICENI
  UFM_RADAUTI
  UFM_VATRA_DORNEI
  UFO_GURA_HUMORULUI
  UFO_SIRET
  AJFP_VASLUI
  UFM_BARLAD
  UFM_HUSI
  UFO_NEGRESTI
  DGRF_PLOIESTI
  AJFP_ARGES
  UFM_CAMPULUNG
  UFM_CURTEA_DE_ARGES
  UFO_COSTESTI
  UFO_TOPOLOVENI
  UFO_MIOVENI
  AJFP_CALARASI
  UFM_OLTENITA
  UFO_LEHLIU
  UFO_BUDESTI
  AJFP_DAMBOVITA
  UFM_MORENI
  UFO_PUCIOASA
  UFO_GAESTI
  UFO_TITU
  AJFP_GIURGIU
  UFO_BOLINTIN_VALE
  UFO_MIHAILESTI
  AJFP_IALOMITA
  UFM_FETESTI
  UFM_URZICENI
  AJFP_PRAHOVA
  UFM_CAMPINA
  UFO_BAICOI
  UFO_BUSTENI
  UFO_BOLDESTI_SCAENI
  UFO_MIZIL
  UFO_SLANIC
  UFO_VALENII_DE_MUNTE
  AJFP_TELEORMAN
  UFM_TURNU_MAGURELE
  UFM_ROSIORII_DE_VEDE
  UFO_VIDELE
  UFO_ZIMNICEA
  DGRF_TIMISOARA
  AJFP_ARAD
  UFO_CHISINEU_CRIS
  UFO_LIPOVA
  UFO_INEU
  UFO_SEBIS
  SFC_SAVARSIN
  AJFP_CARAS_SEVERIN
  UFM_CARANSEBES
  UFO_BAILE_HERCULANE
  UFO_MOLDOVA_NOUA
  UFO_ORAVITA
  UFO_OTELU_ROSU
  SFC_BOZOVICI
  AJFP_HUNEDOARA
  UFM_BRAD
  UFM_HUNEDOARA
  UFM_ORASTIE
  UFM_PETROSANI
  UFO_HATEG
  AJFP_TIMIS
  UFM_LUGOJ
  UFO_BUZIAS
  UFO_DETA
  UFO_FAGET
  UFO_JIMBOLIA
  UFO_SANNICOLAU_MARE
}

// ====================== MODELS ======================

model Client {
  id              Int       @id @default(autoincrement())
  denumire        String
  tip             Tip
  cui             String    @unique
  activa          Boolean
  dataVerificarii DateTime?
  adresa          String?
  administratie   Administratie

  impozit         Impozit?
  platitorTVA     DaLunarTrim @map("DaLunarTrim")
  tvaLaIncasare   Boolean?
  areCodTVAUE     Boolean?
  codTVAUE        String?
  operatiuneUE    Boolean?
  dividende       Boolean?
  salariati       DaLunarTrim?
  casaDeMarcat    Boolean?

  detalii         Detalii?
  puncteDeLucru   PunctDeLucru[]
  istorice        Istoric[]
  tasks           Task[]

  dataExpSediuSocial     DateTime?
  dataExpMandatAdmin     DateTime?
  dataCertificatFiscal   DateTime?
  dataFisaPlatitor       DateTime?
  dataVectFiscal         DateTime?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  users UserClient[] // Many-to-many relationship with User
}

// ====================== DETALII ======================

model Detalii {
  id                       Int       @id @default(autoincrement())
  registruUC               Boolean
  registruEvFiscala        DaNuNuECazul
  ofSpalareBani            Boolean
  regulamentOrdineInterioara Boolean
  manualPoliticiContabile  Boolean
  adresaRevisal            Boolean
  parolaITM                String?
  depunereDeclaratiiOnline Boolean
  accesDosarFiscal         DaNuNuECazul

  clientId Int    @unique
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

// ====================== PUNCTE DE LUCRU ======================

model PunctDeLucru {
  id             Int            @id @default(autoincrement())
  denumire       String
  deLa           DateTime
  panaLa         DateTime?
  administratie  Administratie
  registruUC     Boolean
  salariati      Int
  cui            String?
  casaDeMarcat   Boolean

  clientId Int
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

// ====================== ISTORIC ======================

model Istoric {
  id              Int        @id @default(autoincrement())
  anul            Int
  cifraAfaceri    Float
  inventar        Boolean
  bilantSemIun    DaNuNuECazul
  bilantAnual     DaNuNuECazul

  clientId Int
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@unique([clientId, anul])
}

// ====================== TASKS ======================

model Task {
  id        Int      @id @default(autoincrement())
  done      Boolean  @default(false)
  title     String
  notes     String?  // optional
  blocked   String?  // optional
  objective String?  // optional
  date      DateTime

  userId   Int    
  user     User   @relation(fields: [userId], references: [id])
  clientId Int    
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)
}

// ====================== RULES ======================

model Rule {
  id          Int       @id @default(autoincrement())
  name        String    @unique // e.g. "Declaratii 300 si 394"
  description String?   // human-readable description or notes
  frequency   Frequency // MONTHLY, QUARTERLY, YEARLY, etc.
  taskTitle   String    // title for generated task
  taskNotes   String?   // optional text for generated task
  active      Boolean   @default(true)

  conditions  RuleCondition[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model RuleCondition {
  id        Int       @id @default(autoincrement())
  field     String    // name of the Customer field, e.g. "DaLunarTrim"
  operator  ConditionOperator @default(EQUALS)
  value     String    // stored as text; interpret based on the field
  ruleId    Int
  rule      Rule      @relation(fields: [ruleId], references: [id], onDelete: Cascade)
}

enum ConditionOperator {
  EQUALS
  NOT_EQUALS
  IS_TRUE
  IS_FALSE
  IN
}

enum Frequency {
  MONTHLY
  QUARTERLY
  YEARLY
}

model UserClient {
  id       Int    @id @default(autoincrement())
  userId   Int
  clientId Int
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@unique([userId, clientId]) // Ensure unique user-client pairs
}